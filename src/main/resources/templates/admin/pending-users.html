<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>Pending Users - Admin</title>
    <link th:href="@{/webjars/bootstrap/css/bootstrap.min.css}" rel="stylesheet">
    <link th:href="@{/webjars/font-awesome/css/all.min.css}" rel="stylesheet">
    <style>
        :root {
            --primary: #059862;
            --primary-light: #07be7b;
            --primary-dark: #047a4e;
            --secondary: #192734;
            --bg-body: #15202B;
            --bg-card: #192734;
            --bg-light: #22303c;
            --border: #38444d;
            --text: #ffffff;
            --text-light: #8899a6;
            --radius: 12px;
        }

        body {
            background-color: var(--bg-body);
            font-family: 'Inter', 'Segoe UI', sans-serif;
            color: var(--text);
        }

        .navbar {
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.4);
            background-color: var(--bg-card) !important;
            padding: 1rem 0;
            border-bottom: 1px solid var(--border);
        }

        .navbar-brand {
            color: var(--text) !important;
            font-size: 1.5rem;
            font-weight: 700;
        }

        .nav-link {
            color: var(--text-light) !important;
        }

        .nav-link:hover,
        .nav-link.active {
            color: var(--primary) !important;
        }

        .card {
            border: 1px solid var(--border);
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            background-color: var(--bg-card);
        }

        .alert-info {
            background-color: rgba(29, 155, 240, 0.1);
            color: #1d9bf0;
            border: 1px solid rgba(29, 155, 240, 0.2);
        }

        .alert-success {
            background-color: rgba(5, 152, 98, 0.1);
            color: var(--primary);
            border: 1px solid rgba(5, 152, 98, 0.2);
        }

        .alert-danger {
            background-color: rgba(249, 24, 128, 0.1);
            color: #f91880;
            border: 1px solid rgba(249, 24, 128, 0.2);
        }

        .table {
            --bs-table-bg: transparent;
            --bs-table-color: var(--text);
            --bs-table-striped-color: var(--text);
            --bs-table-striped-bg: rgba(255, 255, 255, 0.05);
            --bs-table-hover-color: var(--text);
            --bs-table-hover-bg: rgba(5, 152, 98, 0.05);
            color: var(--text);
            border-color: var(--border);
        }

        .table thead th {
            border-bottom: 2px solid var(--border);
            color: var(--text-light);
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.85rem;
        }

        .table td {
            vertical-align: middle;
            border-color: var(--border);
            color: var(--text);
        }

        .text-muted {
            color: var(--text-light) !important;
        }

        /* Light Theme Overrides */
        .light-theme {
            --primary: #059862;
            --primary-light: #07be7b;
            --primary-dark: #047a4e;
            --secondary: #ffffff;
            --bg-body: #f5f7fa;
            --bg-card: #ffffff;
            --bg-light: #f8fafc;
            --border: #e3e8f0;
            --text: #1a202c;
            --text-light: #64748b;
        }

        .light-theme .navbar {
            background-color: #ffffff !important;
            border-bottom: 1px solid #e3e8f0;
        }

        .light-theme .table {
            --bs-table-striped-bg: rgba(0, 0, 0, 0.02);
        }
    </style>
</head>

<body th:classappend="${session.theme == 'light' ? 'light-theme' : ''}">
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container-fluid">
            <a class="navbar-brand fw-bold" href="/admin/dashboard">
                <i class="fas fa-user-shield me-2"></i>Admin Portal
            </a>
            <div class="d-flex align-items-center gap-3">
                <!-- Theme Toggle Removed -->
                <a class="nav-link" href="/admin/dashboard">
                    <i class="fas fa-arrow-left me-1"></i> Dashboard
                </a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="d-flex align-items-center mb-4">
            <h2 class="fw-bold mb-0" style="color: var(--text);">Pending User Approvals</h2>
        </div>

        <div class="alert alert-info mb-4 border-radius-12">
            <h6 class="fw-bold"><i class="fas fa-info-circle me-1"></i> Identity Verification Process</h6>
            <p class="mb-0 small">Users must upload government-issued ID documents. Clients also need business licenses.
                Review documents carefully before approving.</p>
        </div>

        <div th:if="${success}" class="alert alert-success" th:text="${success}"></div>
        <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>

        <div class="card border-0">
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-striped table-hover mb-0">
                        <thead class="bg-light">
                            <tr>
                                <th class="ps-4">Email</th>
                                <th>User Type</th>
                                <th>Registration Date</th>
                                <th>Documents</th>
                                <th>Verification Status</th>
                                <th class="text-end pe-4">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="user : ${users}">
                                <td class="ps-4 fw-bold" th:text="${user.email}"></td>
                                <td>
                                    <span class="badge"
                                        th:classappend="${user.userTypeId.userTypeId == 1 ? 'bg-info text-dark' : 'bg-success'}"
                                        th:text="${user.userTypeId != null ? user.userTypeId.userTypeName : ''}">
                                    </span>
                                </td>
                                <td th:text="${#dates.format(user.registrationDate, 'dd-MM-yyyy')}"></td>
                                <td>
                                    <div th:if="${user.userTypeId != null && user.userTypeId.userTypeId == 1}">
                                        <a class="btn btn-sm btn-outline-primary me-1"
                                            th:if="${recruiterProfiles[user.userId] != null and recruiterProfiles[user.userId].verificationDocument != null and recruiterProfiles[user.userId].verificationDocument != ''}"
                                            th:href="@{/admin/users/{id}/download-verification(id=${user.userId}, type='verification')}">
                                            <i class="fas fa-id-card me-1"></i> ID
                                        </a>
                                        <a class="btn btn-sm btn-outline-primary"
                                            th:if="${recruiterProfiles[user.userId] != null and recruiterProfiles[user.userId].businessLicense != null and recruiterProfiles[user.userId].businessLicense != ''}"
                                            th:href="@{/admin/users/{id}/download-verification(id=${user.userId}, type='license')}">
                                            <i class="fas fa-file-contract me-1"></i> License
                                        </a>
                                    </div>
                                    <div th:if="${user.userTypeId != null && user.userTypeId.userTypeId == 2}">
                                        <a class="btn btn-sm btn-outline-primary"
                                            th:if="${jobSeekerProfiles[user.userId] != null and jobSeekerProfiles[user.userId].verificationDocument != null and jobSeekerProfiles[user.userId].verificationDocument != ''}"
                                            th:href="@{/admin/users/{id}/download-verification(id=${user.userId}, type='verification')}">
                                            <i class="fas fa-id-card me-1"></i> ID
                                        </a>
                                    </div>
                                </td>
                                <td>
                                    <div
                                        th:if="${user.userTypeId != null && user.userTypeId.userTypeId == 1 && recruiterProfiles[user.userId] != null}">
                                        <span class="badge bg-warning text-dark"
                                            th:text="${recruiterProfiles[user.userId].documentStatus != null ? recruiterProfiles[user.userId].documentStatus : 'pending'}"></span>
                                        <span class="badge bg-warning text-dark"
                                            th:text="${recruiterProfiles[user.userId].businessLicenseStatus != null ? recruiterProfiles[user.userId].businessLicenseStatus : 'pending'}"></span>
                                        <span class="badge bg-success"
                                            th:if="${recruiterProfiles[user.userId].isVerified}">verified</span>
                                    </div>
                                    <div
                                        th:if="${user.userTypeId != null && user.userTypeId.userTypeId == 2 && jobSeekerProfiles[user.userId] != null}">
                                        <span class="badge bg-warning text-dark"
                                            th:text="${jobSeekerProfiles[user.userId].documentStatus != null ? jobSeekerProfiles[user.userId].documentStatus : 'pending'}"></span>
                                        <span class="badge bg-success"
                                            th:if="${jobSeekerProfiles[user.userId].isVerified}">verified</span>
                                    </div>
                                    <div>
                                        <small class="text-muted">Ready for review</small>
                                    </div>
                                </td>
                                <td class="text-end pe-4">
                                    <a th:href="@{/admin/users/{id}/details(id=${user.userId})}"
                                        class="btn btn-sm btn-info me-1 text-white">
                                        <i class="fas fa-eye"></i>
                                    </a>
                                    <form th:action="@{/admin/users/{id}/verify(id=${user.userId})}" method="post"
                                        class="d-inline">
                                        <input type="hidden" name="approved" value="true">
                                        <button type="submit" class="btn btn-sm btn-success" title="Approve">
                                            <i class="fas fa-check"></i>
                                        </button>
                                    </form>
                                    <form th:action="@{/admin/users/{id}/verify(id=${user.userId})}" method="post"
                                        class="d-inline">
                                        <input type="hidden" name="approved" value="false">
                                        <button type="submit" class="btn btn-sm btn-danger" title="Reject">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </form>
                                </td>
                            </tr>
                            <tr th:if="${#lists.isEmpty(users)}">
                                <td colspan="6" class="text-center py-5">
                                    <h4 class="text-muted">No pending users</h4>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script th:src="@{/webjars/jquery/jquery.min.js}"></script>
    <script th:src="@{/webjars/bootstrap/js/bootstrap.bundle.min.js}"></script>
</body>

</html>