<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="https://www.thymeleaf.org/">

<head>
    <meta charset="UTF-8" />
    <title>Edit Profile | Jobify</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link th:href="@{/webjars/bootstrap/css/bootstrap.min.css}" rel="stylesheet" />
    <link th:href="@{/webjars/font-awesome/css/all.min.css}" rel="stylesheet" />
    <link rel="stylesheet" type="text/css" th:href="@{/css/styles.css}" />
    <!-- Summernote -->
    <link th:rel="stylesheet" type="text/css" media="all" th:href="@{/summernote/summernote-lite.min.css}" />
</head>

<body class="bg-light d-flex flex-column min-vh-100">

    <!-- Header -->
    <th:block th:replace="fragments/client-header :: clientHeader('profile')"></th:block>

    <div class="container py-5 flex-grow-1">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2 class="fw-bold mb-0">Edit Profile</h2>
            <a th:href="@{/client-dashboard/}" class="btn btn-outline-primary rounded-pill px-4 btn-sm fw-bold">
                <i class="fas fa-arrow-left me-2"></i> Dashboard
            </a>
        </div>
        <form th:action="@{/recruiter-profile/addNew}" method="post" th:object="${profile}"
            enctype="multipart/form-data">

            <div class="row g-4">
                <!-- Left Sidebar: Identity & Avatar -->
                <div class="col-lg-4">
                    <div class="card border-0 shadow-sm rounded-4 text-center p-4 sticky-top"
                        style="top: 100px; z-index: 1000;">
                        <h5 class="fw-bold mb-4 text-start">Profile Photo</h5>
                        <div class="position-relative d-inline-block mx-auto mb-3">
                            <img id="avatarPreview"
                                th:src="${profile.photosImagePath != null ? profile.photosImagePath : 'https://ui-avatars.com/api/?name=' + user.firstName + '+' + user.lastName + '&background=0d6efd&color=fff'}"
                                class="rounded-circle img-thumbnail"
                                style="width: 150px; height: 150px; object-fit: cover;" />
                            <label for="imageUpload"
                                class="position-absolute bottom-0 end-0 bg-primary text-white rounded-circle p-2 shadow-sm border border-white"
                                style="cursor: pointer; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; transition: all 0.2s;">
                                <i class="fas fa-camera"></i>
                                <input type="file" id="imageUpload" class="d-none" name="image" accept="image/*"
                                    onchange="previewImage(this)">
                            </label>
                        </div>

                        <h4 class="fw-bold mb-1" th:text="${(user.firstName ?: '') + ' ' + (user.lastName ?: '')}">
                            Recruiter Name</h4>
                        <p class="text-muted small mb-3">Recruiter Account</p>

                        <!-- Verification Status -->
                        <div class="mb-4">
                            <span
                                class="badge bg-success-subtle text-success border border-success-subtle rounded-pill px-3 py-2"
                                th:if="${user.isVerified}">
                                <i class="fas fa-check-circle me-1"></i> Verified
                            </span>
                            <span
                                class="badge bg-warning-subtle text-warning border border-warning-subtle rounded-pill px-3 py-2"
                                th:if="${!user.isVerified && user.documentStatus == 'UNDER_REVIEW'}">
                                <i class="fas fa-clock me-1"></i> Pending Review
                            </span>
                            <span
                                class="badge bg-danger-subtle text-danger border border-danger-subtle rounded-pill px-3 py-2"
                                th:if="${!user.isVerified && user.documentStatus != 'UNDER_REVIEW'}">
                                <i class="fas fa-times-circle me-1"></i> Unverified
                            </span>
                        </div>

                        <div class="text-start">
                            <div class="alert alert-light border text-muted small">
                                <i class="fas fa-info-circle me-1"></i> Upload a clear photo to increase trust with
                                candidates.
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Column: Details Loop -->
                <div class="col-lg-8">

                    <!-- Section 1: Basic Info -->
                    <div class="card border-0 shadow-sm rounded-4 mb-4 animate-up delay-100">
                        <div class="card-header bg-white border-bottom-0 pt-4 px-4">
                            <h5 class="fw-bold text-dark mb-0"><i
                                    class="fas fa-user-circle text-primary me-2"></i>Personal Details
                            </h5>
                        </div>
                        <div class="card-body p-4">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="form-label fw-semibold">First Name</label>
                                    <input type="text" class="form-control" th:field="*{firstName}" placeholder="John"
                                        required />
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label fw-semibold">Last Name</label>
                                    <input type="text" class="form-control" th:field="*{lastName}" placeholder="Doe"
                                        required />
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label fw-semibold">City</label>
                                    <input type="text" class="form-control" th:field="*{city}" placeholder="New York" />
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label fw-semibold">State/Region</label>
                                    <input type="text" class="form-control" th:field="*{state}" placeholder="NY" />
                                </div>
                                <div class="col-md-12">
                                    <label class="form-label fw-semibold">Country</label>
                                    <input type="text" class="form-control" th:field="*{country}"
                                        placeholder="United States" />
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Section 2: Company Info -->
                    <div class="card border-0 shadow-sm rounded-4 mb-4 animate-up delay-200">
                        <div class="card-header bg-white border-bottom-0 pt-4 px-4">
                            <h5 class="fw-bold text-dark mb-0"><i class="fas fa-building text-primary me-2"></i>Company
                                Profile</h5>
                        </div>
                        <div class="card-body p-4">
                            <div class="row g-3">
                                <div class="col-md-12">
                                    <label class="form-label fw-semibold">Company Name</label>
                                    <input type="text" class="form-control" th:field="*{company}"
                                        placeholder="Acme Inc." />
                                </div>
                                <div class="col-md-12">
                                    <label class="form-label fw-semibold">Tagline <span
                                            class="text-muted fw-normal small">(Optional)</span></label>
                                    <input type="text" class="form-control" th:field="*{tagline}"
                                        placeholder="Transforming the future of tech..." />
                                    <div class="form-text text-muted small">A short, catchy line to appear on your
                                        profile.</div>
                                </div>
                                <div class="col-md-12">
                                    <label class="form-label fw-semibold">Website <span
                                            class="text-muted fw-normal small">(Optional)</span></label>
                                    <div class="input-group">
                                        <span class="input-group-text bg-light border-end-0"><i
                                                class="fas fa-globe text-muted"></i></span>
                                        <input type="url" class="form-control border-start-0 ps-0" th:field="*{website}"
                                            placeholder="https://www.example.com" />
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <label class="form-label fw-semibold">Bio / About Company</label>
                                    <textarea class="form-control" id="bio" th:field="*{bio}" rows="5"
                                        placeholder="Tell us about your company culture, mission, and what you're looking for..."></textarea>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Section 3: Verification -->
                    <div class="card border-0 shadow-sm rounded-4 mb-4 animate-up delay-300">
                        <div class="card-header bg-white border-bottom-0 pt-4 px-4">
                            <h5 class="fw-bold text-dark mb-0"><i
                                    class="fas fa-shield-alt text-primary me-2"></i>Identity Verification</h5>
                        </div>
                        <div class="card-body p-4">
                            <div class="alert alert-primary bg-primary-subtle border-primary-subtle text-primary d-flex align-items-center mb-4"
                                role="alert">
                                <i class="fas fa-info-circle me-3 fs-5"></i>
                                <div>
                                    To maintain a safe community, we require all recruiters to verify their identity
                                    before posting jobs.
                                </div>
                            </div>

                            <div class="row g-4">
                                <div class="col-md-6">
                                    <label class="form-label fw-semibold">Front ID (Govt. Issued)</label>
                                    <div class="file-upload-wrapper p-3 border rounded-3 bg-light text-center">
                                        <input type="file" class="form-control form-control-sm mb-2"
                                            name="verificationFrontFile" accept="image/*" />
                                        <small class="text-muted d-block">Passport or Driver's License</small>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label fw-semibold">Back ID</label>
                                    <div class="file-upload-wrapper p-3 border rounded-3 bg-light text-center">
                                        <input type="file" class="form-control form-control-sm mb-2"
                                            name="verificationBackFile" accept="image/*" />
                                        <small class="text-muted d-block">Back side of ID</small>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <label class="form-label fw-semibold">Business License <span
                                            class="text-muted fw-normal small">(Optional)</span></label>
                                    <input type="file" class="form-control" name="businessLicenseFile"
                                        accept="image/*,application/pdf" />
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="d-flex justify-content-end gap-3 animate-up delay-300 mb-5">
                        <a th:href="@{/client-dashboard/}" class="btn btn-light px-4 border">Cancel</a>
                        <button type="submit" class="btn btn-primary px-5 fw-bold shadow-sm">
                            Save Changes
                        </button>
                    </div>

                </div>
            </div>
        </form>
    </div>

    <!-- Footer -->
    <th:block th:replace="fragments/footer :: footer"></th:block>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script th:src="@{/summernote/summernote-lite.min.js}"></script>

    <script>
        $(document).ready(function () {
            // Initialize Summernote for Bio
            $('#bio').summernote({
                height: 200,
                placeholder: "Tell us about your company culture, mission, and what you're looking for...",
                toolbar: [
                    ['style', ['style']],
                    ['font', ['bold', 'underline', 'clear']],
                    ['color', ['color']],
                    ['para', ['ul', 'ol', 'paragraph']],
                    ['insert', ['link']],
                    ['view', ['codeview', 'help']]
                ]
            });
        });

        // Image Preview Logic
        function previewImage(input) {
            if (input.files && input.files[0]) {
                var reader = new FileReader();
                reader.onload = function (e) {
                    $('#avatarPreview').attr('src', e.target.result);
                }
                reader.readAsDataURL(input.files[0]);
            }
        }
    </script>

    <style>
        .file-upload-wrapper:hover {
            border-color: #0d6efd !important;
            background-color: #fff !important;
        }

        .form-control:focus {
            box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.15);
            border-color: #0d6efd;
        }

        .animate-up {
            animation: fadeInUp 0.5s ease-out forwards;
            opacity: 0;
            transform: translateY(20px);
        }

        .delay-100 {
            animation-delay: 0.1s;
        }

        .delay-200 {
            animation-delay: 0.2s;
        }

        .delay-300 {
            animation-delay: 0.3s;
        }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>

    <!-- SweetAlert for Success/Error -->
    <script th:inline="javascript">
        /*<![CDATA[*/
        var success = /*[[${success}]]*/ false;
        var verificationSuccess = /*[[${verificationSuccess}]]*/ false;
        var errorMsg = /*[[${error}]]*/ null;

        if (success && !verificationSuccess) {
            Swal.fire({
                title: 'Profile Saved!',
                text: 'Your profile has been updated successfully.',
                icon: 'success',
                confirmButtonColor: '#0d6efd'
            });
        }

        if (verificationSuccess) {
            Swal.fire({
                title: 'Documents Submitted Successfully!',
                text: 'Please verify your identity to enable full access to hiring features. Status will be updated after admin approval.',
                icon: 'success',
                confirmButtonColor: '#0d6efd'
            });
        }

        if (errorMsg) {
            Swal.fire({
                title: 'Error',
                text: errorMsg,
                icon: 'error',
                confirmButtonColor: '#0d6efd'
            });
        }
        /*]]>*/
    </script>
</body>

</html>