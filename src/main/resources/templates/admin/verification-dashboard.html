<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verification Dashboard - Jobify Admin</title>
    <link th:href="@{/webjars/bootstrap/css/bootstrap.min.css}" rel="stylesheet">
    <link th:href="@{/webjars/font-awesome/css/all.min.css}" rel="stylesheet">
    <link th:href="@{/css/admin-styles.css}" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: var(--bg-body);
            color: var(--text);
            min-height: 100vh;
        }

        .navbar {
            background: var(--bg-card);
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.4);
            border-bottom: 1px solid var(--border);
        }

        .navbar-brand {
            color: var(--text) !important;
            font-weight: 700;
        }

        .verification-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        .page-header {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            border: 1px solid var(--border);
        }

        .page-header h1 {
            color: var(--text);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            border: 1px solid var(--border);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
            border-color: var(--primary);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: var(--primary);
        }

        .stat-card.danger::before {
            background: var(--danger);
        }

        .stat-card.success::before {
            background: var(--success);
        }

        .stat-card.warning::before {
            background: var(--warning);
        }

        .stat-card.info::before {
            background: var(--info);
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            margin-bottom: 1rem;
        }

        .stat-card.danger .stat-icon {
            color: var(--danger);
            background: rgba(249, 24, 128, 0.1);
            border-color: rgba(249, 24, 128, 0.2);
        }

        .stat-card.success .stat-icon {
            color: var(--success);
            background: rgba(5, 152, 98, 0.1);
            border-color: rgba(5, 152, 98, 0.2);
        }

        .stat-card.warning .stat-icon {
            color: var(--warning);
            background: rgba(255, 180, 0, 0.1);
            border-color: rgba(255, 180, 0, 0.2);
        }

        .stat-card.info .stat-icon {
            color: var(--info);
            background: rgba(29, 155, 240, 0.1);
            border-color: rgba(29, 155, 240, 0.2);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: var(--text-light);
            font-weight: 500;
            font-size: 0.95rem;
        }

        .verification-tabs {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            border: 1px solid var(--border);
            margin-bottom: 2rem;
        }

        .nav-tabs {
            border-bottom: 2px solid var(--border);
            margin-bottom: 2rem;
        }

        .nav-tabs .nav-link {
            border: none;
            color: var(--text-light);
            font-weight: 500;
            padding: 1rem 1.5rem;
            border-radius: 8px 8px 0 0;
            transition: all 0.3s ease;
        }

        .nav-tabs .nav-link:hover {
            background: rgba(255, 255, 255, 0.05);
            color: var(--text);
        }

        .nav-tabs .nav-link.active {
            background: rgba(5, 152, 98, 0.1);
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
            font-weight: 600;
        }

        .verification-card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            border: 1px solid var(--border);
            transition: all 0.3s ease;
        }

        .verification-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
            border-color: var(--primary);
        }

        .user-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 1.2rem;
        }

        .user-details h5 {
            margin: 0;
            color: var(--text);
            font-weight: 600;
        }

        .user-details p {
            margin: 0.25rem 0 0 0;
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .verification-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .status-pending {
            background: rgba(255, 180, 0, 0.1);
            color: var(--warning);
            border: 1px solid rgba(255, 180, 0, 0.2);
        }

        .status-approved {
            background: rgba(5, 152, 98, 0.1);
            color: var(--success);
            border: 1px solid rgba(5, 152, 98, 0.2);
        }

        .status-rejected {
            background: rgba(249, 24, 128, 0.1);
            color: var(--danger);
            border: 1px solid rgba(249, 24, 128, 0.2);
        }

        .document-section {
            margin-bottom: 1.5rem;
        }

        .document-section h6 {
            color: var(--text);
            font-weight: 600;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .document-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }

        .document-item {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            padding: 1rem;
            border: 1px solid var(--border);
            transition: all 0.3s ease;
        }

        .document-item:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: var(--primary);
        }

        .document-preview {
            width: 100%;
            height: 150px;
            background: var(--bg-light);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 0.75rem;
            border: 1px solid var(--border);
            overflow: hidden;
        }

        .document-preview img {
            max-width: 100%;
            max-height: 100%;
            object-fit: cover;
        }

        .document-info {
            font-size: 0.85rem;
            color: var(--text-light);
        }

        .document-name {
            font-weight: 500;
            color: var(--text);
            margin-bottom: 0.25rem;
        }

        .verification-actions {
            display: flex;
            gap: 1rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--border);
        }

        .btn-action {
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            border: none;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-approve {
            background: var(--success);
            color: white;
        }

        .btn-approve:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(5, 152, 98, 0.3);
            filter: brightness(1.1);
        }

        .btn-reject {
            background: var(--danger);
            color: white;
        }

        .btn-reject:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(249, 24, 128, 0.3);
            filter: brightness(1.1);
        }

        .btn-review {
            background: var(--info);
            color: white;
        }

        .btn-review:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(29, 155, 240, 0.3);
            filter: brightness(1.1);
        }

        .notes-section {
            margin-top: 1rem;
        }

        .notes-textarea {
            width: 100%;
            min-height: 100px;
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 0.75rem;
            font-size: 0.9rem;
            resize: vertical;
            background: var(--bg-body);
            color: var(--text);
        }

        .notes-textarea:focus {
            outline: none;
            border-color: var(--primary);
        }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--text-light);
            font-weight: 500;
        }

        .empty-state i {
            display: block;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .badge-count {
            background: var(--danger);
            color: white;
            border-radius: 10px;
            padding: 0.2rem 0.5rem;
            font-size: 0.7rem;
            margin-left: 0.5rem;
        }



        /* Text Utilities Overrides */
        .text-muted {
            color: var(--text-light) !important;
        }

        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            color: var(--text);
        }
    </style>
</head>

<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light">
        <div class="container-fluid">
            <a class="navbar-brand" href="/admin/dashboard">
                <i class="fas fa-shield-alt me-2"></i>
                Jobify Admin Portal
            </a>
            <div class="navbar-nav ms-auto d-flex align-items-center gap-3">
                <!-- Theme Toggle Removed -->
                <a class="nav-link text-white" href="/admin/dashboard" style="color: var(--text-light) !important;">
                    <i class="fas fa-tachometer-alt me-1"></i>
                    Dashboard
                </a>
                <a class="nav-link text-white" href="/logout" style="color: var(--text-light) !important;">
                    <i class="fas fa-sign-out-alt me-1"></i>
                    Logout
                </a>
            </div>
        </div>
    </nav>

    <div class="verification-container">
        <!-- Page Header -->
        <div class="page-header">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1 class="h2 mb-2">
                        <i class="fas fa-user-check me-2" style="color: var(--primary);"></i>
                        Verification Dashboard
                    </h1>
                    <p class="text-muted mb-0">Review and manage user verification documents and job approvals</p>
                </div>
                <div class="text-end">
                    <button class="btn-action btn-review" onclick="refreshData()">
                        <i class="fas fa-sync-alt"></i>
                        Refresh
                    </button>
                </div>
            </div>
        </div>

        <!-- Statistics Cards -->
        <div class="stats-grid">
            <div class="stat-card danger">
                <div class="stat-icon">
                    <i class="fas fa-user-clock"></i>
                </div>
                <div class="stat-value" th:text="${stats.pendingRecruiters}">0</div>
                <div class="stat-label">Pending Clients</div>
            </div>

            <div class="stat-card warning">
                <div class="stat-icon">
                    <i class="fas fa-user-friends"></i>
                </div>
                <div class="stat-value" th:text="${stats.pendingJobSeekers}">0</div>
                <div class="stat-label">Pending freelancers</div>
            </div>

            <div class="stat-card info">
                <div class="stat-icon">
                    <i class="fas fa-briefcase"></i>
                </div>
                <div class="stat-value" th:text="${stats.pendingJobs}">0</div>
                <div class="stat-label">Pending Jobs</div>
            </div>

            <div class="stat-card success">
                <div class="stat-icon">
                    <i class="fas fa-check-circle"></i>
                </div>
                <div class="stat-value" th:text="${stats.totalVerified}">0</div>
                <div class="stat-label">Total Verified</div>
            </div>
        </div>

        <!-- Verification Tabs -->
        <div class="verification-tabs">
            <ul class="nav nav-tabs" id="verificationTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="recruiters-tab" data-bs-toggle="tab"
                        data-bs-target="#recruiters" type="button" role="tab">
                        <i class="fas fa-user-tie me-2"></i>
                        Clients
                        <span class="badge-count" th:if="${pendingRecruitersCount > 0}"
                            th:text="${pendingRecruitersCount}"></span>
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="jobseekers-tab" data-bs-toggle="tab" data-bs-target="#jobseekers"
                        type="button" role="tab">
                        <i class="fas fa-user-friends me-2"></i>
                        freelancers
                        <span class="badge-count" th:if="${pendingJobSeekersCount > 0}"
                            th:text="${pendingJobSeekersCount}"></span>
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="jobs-tab" data-bs-toggle="tab" data-bs-target="#jobs" type="button"
                        role="tab">
                        <i class="fas fa-briefcase me-2"></i>
                        Job Postings
                        <span class="badge-count" th:if="${pendingJobsCount > 0}" th:text="${pendingJobsCount}"></span>
                    </button>
                </li>
            </ul>

            <div class="tab-content" id="verificationTabsContent">
                <!-- Recruiters Tab -->
                <div class="tab-pane fade show active" id="recruiters" role="tabpanel">
                    <div th:if="${#lists.isEmpty(pendingRecruiters)}" class="empty-state">
                        <i class="fas fa-user-check"></i>
                        <h5>No Pending Client Verifications</h5>
                        <p>All client verification requests have been processed.</p>
                    </div>

                    <div th:each="recruiter : ${pendingRecruiters}" class="verification-card">
                        <div class="user-header">
                            <div class="user-info">
                                <div class="user-avatar">
                                    <span
                                        th:text="${recruiterProfiles[recruiter.userId]?.firstName?.charAt(0) ?: 'R'}"></span>
                                </div>
                                <div class="user-details">
                                    <h5
                                        th:text="${(recruiterProfiles[recruiter.userId]?.firstName ?: '') + ' ' + (recruiterProfiles[recruiter.userId]?.lastName ?: '')}">
                                        John Doe</h5>
                                    <p th:text="${recruiter.email}">john@example.com</p>
                                    <small class="text-muted">
                                        <i class="fas fa-building me-1"></i>
                                        <span th:text="${recruiterProfiles[recruiter.userId]?.company ?: 'N/A'}">Company
                                            Name</span> •
                                        <i class="fas fa-calendar me-1"></i>
                                        <span
                                            th:text="${recruiter.registrationDate != null ? #dates.format(recruiter.registrationDate, 'dd-MM-yyyy') : 'N/A'}">01-01-2024</span>
                                    </small>
                                </div>
                            </div>
                            <div class="verification-status status-pending">
                                <i class="fas fa-clock"></i>
                                Pending Review
                            </div>
                        </div>

                        <div class="document-section">
                            <h6><i class="fas fa-file-alt me-2"></i>Verification Documents</h6>
                            <div class="document-grid">
                                <!-- ID Front Side -->
                                <div class="document-item"
                                    th:if="${recruiterProfiles[recruiter.userId]?.verificationFront}">
                                    <div class="document-preview" style="cursor: pointer"
                                        onclick="openDocument(this.querySelector('img').src, 'ID Front')">
                                        <img th:src="@{'/photos/recruiter/' + ${recruiter.userId} + '/' + ${recruiterProfiles[recruiter.userId].verificationFront}}"
                                            alt="ID Front">
                                    </div>
                                    <div class="document-info">
                                        <div class="document-name">ID (Front)</div>
                                        <small
                                            th:text="${recruiterProfiles[recruiter.userId].verificationFront}">filename.jpg</small>
                                    </div>
                                </div>

                                <!-- ID Back Side -->
                                <div class="document-item"
                                    th:if="${recruiterProfiles[recruiter.userId]?.verificationBack}">
                                    <div class="document-preview" style="cursor: pointer"
                                        onclick="openDocument(this.querySelector('img').src, 'ID Back')">
                                        <img th:src="@{'/photos/recruiter/' + ${recruiter.userId} + '/' + ${recruiterProfiles[recruiter.userId].verificationBack}}"
                                            alt="ID Back">
                                    </div>
                                    <div class="document-info">
                                        <div class="document-name">ID (Back)</div>
                                        <small
                                            th:text="${recruiterProfiles[recruiter.userId].verificationBack}">filename.jpg</small>
                                    </div>
                                </div>

                                <!-- Legacy ID Document -->
                                <div class="document-item"
                                    th:if="${recruiterProfiles[recruiter.userId]?.verificationDocument}">
                                    <div class="document-preview" style="cursor: pointer"
                                        onclick="openDocument(this.querySelector('img').src, 'ID Document')">
                                        <img th:src="@{'/photos/recruiter/' + ${recruiter.userId} + '/' + ${recruiterProfiles[recruiter.userId].verificationDocument}}"
                                            alt="ID Document">
                                    </div>
                                    <div class="document-info">
                                        <div class="document-name">ID Document</div>
                                        <small
                                            th:text="${recruiterProfiles[recruiter.userId].verificationDocument}">filename.jpg</small>
                                    </div>
                                </div>

                                <!-- Fallback if NO documents found (Visual placeholder) -->
                                <div class="document-item"
                                    th:if="${recruiterProfiles[recruiter.userId]?.verificationFront == null && recruiterProfiles[recruiter.userId]?.verificationBack == null && recruiterProfiles[recruiter.userId]?.verificationDocument == null}">
                                    <div class="document-preview">
                                        <i class="fas fa-file-image fa-3x text-muted"></i>
                                    </div>
                                    <div class="document-info">
                                        <div class="document-name">No ID Uploaded</div>
                                        <small class="text-muted">Missing</small>
                                    </div>
                                </div>
                                <div class="document-item">
                                    <div class="document-preview">
                                        <img th:if="${recruiterProfiles[recruiter.userId]?.businessLicense}"
                                            th:src="@{'/photos/recruiter/' + ${recruiter.userId} + '/' + ${recruiterProfiles[recruiter.userId].businessLicense}}"
                                            alt="Business License">
                                        <i class="fas fa-file-contract fa-3x text-muted"
                                            th:unless="${recruiterProfiles[recruiter.userId]?.businessLicense}"></i>
                                    </div>
                                    <div class="document-info">
                                        <div class="document-name">Business License</div>
                                        <small
                                            th:text="${recruiterProfiles[recruiter.userId]?.businessLicense ?: 'Not uploaded'}">license.pdf</small>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="verification-actions">
                            <form th:action="@{/admin/users/{id}/verify(id=${recruiter.userId})}" method="post"
                                class="d-inline">
                                <input type="hidden" name="approved" value="true">
                                <button type="submit" class="btn-action btn-approve">
                                    <i class="fas fa-check"></i>
                                    Approve
                                </button>
                            </form>
                            <form th:action="@{/admin/users/{id}/verify(id=${recruiter.userId})}" method="post"
                                class="d-inline">
                                <input type="hidden" name="approved" value="false">
                                <button type="submit" class="btn-action btn-reject">
                                    <i class="fas fa-times"></i>
                                    Reject
                                </button>
                            </form>

                            <!-- Ban/Unban -->
                            <form th:if="${recruiter.active == true}" th:action="@{/admin/users/ban}" method="post"
                                class="d-inline" onsubmit="return confirmBan(this);">
                                <input type="hidden" name="userId" th:value="${recruiter.userId}" />
                                <button type="submit" class="btn-action"
                                    style="background-color: #343a40; color: white;">
                                    <i class="fas fa-ban"></i>
                                    Ban
                                </button>
                            </form>
                            <form th:if="${recruiter.active == false}" th:action="@{/admin/users/unban}" method="post"
                                class="d-inline"
                                onsubmit="return confirm('Are you sure you want to unban this user?');">
                                <input type="hidden" name="userId" th:value="${recruiter.userId}" />
                                <button type="submit" class="btn-action"
                                    style="background-color: #6c757d; color: white;">
                                    <i class="fas fa-unlock"></i>
                                    Unban
                                </button>
                            </form>
                            <button class="btn-action btn-review" th:data-userid="${recruiter.userId}"
                                th:data-front="${recruiterProfiles[recruiter.userId]?.verificationFront ?: 'null'}"
                                th:data-back="${recruiterProfiles[recruiter.userId]?.verificationBack ?: 'null'}"
                                th:data-doc="${recruiterProfiles[recruiter.userId]?.verificationDocument ?: 'null'}"
                                th:data-license="${recruiterProfiles[recruiter.userId]?.businessLicense ?: 'null'}"
                                onclick="viewRecruiterDocsFromData(this)">
                                <i class="fas fa-search"></i>
                                Review Documents
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Job Seekers Tab -->
                <div class="tab-pane fade" id="jobseekers" role="tabpanel">
                    <div th:if="${#lists.isEmpty(pendingJobSeekers)}" class="empty-state">
                        <i class="fas fa-user-check"></i>
                        <h5>No Pending Job Seeker Verifications</h5>
                        <p>All job seeker verification requests have been processed.</p>
                    </div>

                    <div th:each="jobSeeker : ${pendingJobSeekers}" class="verification-card">
                        <div class="user-header">
                            <div class="user-info">
                                <div class="user-avatar">
                                    <span
                                        th:text="${jobSeekerProfiles[jobSeeker.userId]?.firstName?.charAt(0) ?: 'J'}"></span>
                                </div>
                                <div class="user-details">
                                    <h5
                                        th:text="${(jobSeekerProfiles[jobSeeker.userId]?.firstName ?: '') + ' ' + (jobSeekerProfiles[jobSeeker.userId]?.lastName ?: '')}">
                                        Jane Smith</h5>
                                    <p th:text="${jobSeeker.email}">jane@example.com</p>
                                    <small class="text-muted">
                                        <i class="fas fa-briefcase me-1"></i>
                                        <span
                                            th:text="${jobSeekerProfiles[jobSeeker.userId]?.employmentType ?: 'N/A'}">Full-time</span>
                                        •
                                        <i class="fas fa-calendar me-1"></i>
                                        <span
                                            th:text="${jobSeeker.registrationDate != null ? #dates.format(jobSeeker.registrationDate, 'dd-MM-yyyy') : 'N/A'}">01-01-2024</span>
                                    </small>
                                </div>
                            </div>
                            <div class="verification-status status-pending">
                                <i class="fas fa-clock"></i>
                                Pending Review
                            </div>
                        </div>

                        <div class="document-section">
                            <h6><i class="fas fa-file-alt me-2"></i>Verification Documents</h6>
                            <div class="document-grid">
                                <div class="document-item">
                                    <div class="document-preview" style="cursor: pointer"
                                        th:onclick="openDocument(this.querySelector('img').src, 'ID Document')">
                                        <img th:if="${jobSeekerProfiles[jobSeeker.userId]?.verificationDocument}"
                                            th:src="@{'/photos/candidate/' + ${jobSeeker.userId} + '/' + ${jobSeekerProfiles[jobSeeker.userId].verificationDocument}}"
                                            alt="ID Document">
                                        <i class="fas fa-file-image fa-3x text-muted"
                                            th:unless="${jobSeekerProfiles[jobSeeker.userId]?.verificationDocument}"></i>
                                    </div>
                                    <div class="document-info">
                                        <div class="document-name">ID Document</div>
                                        <small
                                            th:text="${jobSeekerProfiles[jobSeeker.userId]?.verificationDocument ?: 'Not uploaded'}">id_card.jpg</small>
                                    </div>
                                </div>
                                <div class="document-item">
                                    <div class="document-preview">
                                        <i class="fas fa-file-pdf fa-3x text-muted"></i>
                                    </div>
                                    <div class="document-info">
                                        <div class="document-name">Resume</div>
                                        <small
                                            th:text="${jobSeekerProfiles[jobSeeker.userId]?.resume ?: 'Not uploaded'}">resume.pdf</small>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="verification-actions">
                            <form th:action="@{/admin/users/{id}/verify(id=${jobSeeker.userId})}" method="post"
                                class="d-inline">
                                <input type="hidden" name="approved" value="true">
                                <button type="submit" class="btn-action btn-approve">
                                    <i class="fas fa-check"></i>
                                    Approve
                                </button>
                            </form>
                            <form th:action="@{/admin/users/{id}/verify(id=${jobSeeker.userId})}" method="post"
                                class="d-inline">
                                <input type="hidden" name="approved" value="false">
                                <button type="submit" class="btn-action btn-reject">
                                    <i class="fas fa-times"></i>
                                    Reject
                                </button>
                            </form>

                            <!-- Ban/Unban -->
                            <form th:if="${jobSeeker.active == true}" th:action="@{/admin/users/ban}" method="post"
                                class="d-inline" onsubmit="return confirmBan(this);">
                                <input type="hidden" name="userId" th:value="${jobSeeker.userId}" />
                                <button type="submit" class="btn-action"
                                    style="background-color: #343a40; color: white;">
                                    <i class="fas fa-ban"></i>
                                    Ban
                                </button>
                            </form>
                            <form th:if="${jobSeeker.active == false}" th:action="@{/admin/users/unban}" method="post"
                                class="d-inline"
                                onsubmit="return confirm('Are you sure you want to unban this user?');">
                                <input type="hidden" name="userId" th:value="${jobSeeker.userId}" />
                                <button type="submit" class="btn-action"
                                    style="background-color: #6c757d; color: white;">
                                    <i class="fas fa-unlock"></i>
                                    Unban
                                </button>
                            </form>
                            <button class="btn-action btn-review" th:data-userid="${jobSeeker.userId}"
                                th:data-doc="${jobSeekerProfiles[jobSeeker.userId]?.verificationDocument ?: 'null'}"
                                th:data-resume="${jobSeekerProfiles[jobSeeker.userId]?.resume ?: 'null'}"
                                onclick="viewJobSeekerDocsFromData(this)">
                                <i class="fas fa-search"></i>
                                Review Documents
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Jobs Tab -->
                <div class="tab-pane fade" id="jobs" role="tabpanel">
                    <div th:if="${#lists.isEmpty(pendingJobs)}" class="empty-state">
                        <i class="fas fa-briefcase"></i>
                        <h5>No Pending Job Approvals</h5>
                        <p>All job postings have been reviewed.</p>
                    </div>

                    <div th:each="job : ${pendingJobs}" class="verification-card">
                        <div class="user-header">
                            <div class="user-info">
                                <div class="user-avatar">
                                    <i class="fas fa-briefcase"></i>
                                </div>
                                <div class="user-details">
                                    <h5 th:text="${job.jobTitle}">Senior Developer</h5>
                                    <p th:text="${job.postedById?.email}">company@example.com</p>
                                    <small class="text-muted">
                                        <i class="fas fa-building me-1"></i>
                                        <span th:text="${job.jobCompanyId?.name ?: 'N/A'}">Company Name</span> •
                                        <i class="fas fa-dollar-sign me-1"></i>
                                        <span th:text="${job.salary}">$50,000</span> •
                                        <i class="fas fa-calendar me-1"></i>
                                        <span
                                            th:text="${job.postedDate != null ? #dates.format(job.postedDate, 'dd-MM-yyyy') : 'N/A'}">01-01-2024</span>
                                    </small>
                                </div>
                            </div>
                            <div class="verification-status status-pending">
                                <i class="fas fa-clock"></i>
                                Pending Approval
                            </div>
                        </div>

                        <div class="document-section">
                            <h6><i class="fas fa-info-circle me-2"></i>Job Description</h6>
                            <div class="alert alert-light">
                                <p class="mb-0" th:text="${#strings.abbreviate(job.descriptionOfJob, 300)}">Job
                                    description preview...</p>
                            </div>
                        </div>

                        <div class="verification-actions">
                            <form th:action="@{/admin/jobs/{id}/approve(id=${job.jobPostId})}" method="post"
                                class="d-inline">
                                <input type="hidden" name="approved" value="true">
                                <button type="submit" class="btn-action btn-approve">
                                    <i class="fas fa-check"></i>
                                    Approve Job
                                </button>
                            </form>
                            <form th:action="@{/admin/jobs/{id}/approve(id=${job.jobPostId})}" method="post"
                                class="d-inline">
                                <input type="hidden" name="approved" value="false">
                                <button type="submit" class="btn-action btn-reject">
                                    <i class="fas fa-times"></i>
                                    Reject Job
                                </button>
                            </form>
                            <a th:href="@{/job-details/{id}(id=${job.jobPostId})}" class="btn-action btn-review">
                                <i class="fas fa-eye"></i>
                                View Full Details
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Document Review Modal -->
    <div class="modal fade" id="documentModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Review Verification Documents</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="documentContent">
                        <!-- Documents will be loaded here -->
                    </div>
                </div>
                <div class="modal-footer">
                    <div class="notes-section">
                        <label class="form-label">Verification Notes:</label>
                        <textarea class="notes-textarea" id="verificationNotes"
                            placeholder="Add any notes about this verification..."></textarea>
                    </div>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script th:src="@{/webjars/jquery/jquery.min.js}"></script>
    <script th:src="@{/webjars/bootstrap/js/bootstrap.bundle.min.js}"></script>
    <script>
        function refreshData() {
            window.location.reload();
        }

        // View all documents for a user in one modal
        function viewDocs(userId, front, back, doc, license, resume) {
            const modal = new bootstrap.Modal(document.getElementById('documentModal'));
            const contentDiv = document.getElementById('documentContent');
            const titleEl = document.querySelector('.modal-title');

            titleEl.textContent = 'Verification Documents';
            contentDiv.innerHTML = '';

            let html = '<div class="row g-4">';
            let hasDocs = false;

            const addItem = (title, filename, path) => {
                if (filename && filename !== 'null') {
                    hasDocs = true;
                    const url = path + filename;
                    const isPdf = filename.toLowerCase().endsWith('.pdf');

                    html += `
                        <div class="col-12">
                            <div class="card bg-dark border-secondary">
                                <div class="card-header border-secondary">
                                    <h6 class="mb-0 text-light">${title}</h6>
                                </div>
                                <div class="card-body text-center p-0 overflow-hidden">
                    `;

                    if (isPdf) {
                        html += `
                            <div class="ratio ratio-16x9">
                                <embed src="${url}" type="application/pdf">
                            </div>
                            <div class="p-2 bg-dark border-top border-secondary text-end">
                                <a href="${url}" target="_blank" class="btn btn-sm btn-primary">
                                    <i class="fas fa-external-link-alt"></i> Open PDF
                                </a>
                            </div>
                        `;
                    } else {
                        html += `
                            <div class="p-3">
                                <img src="${url}" class="img-fluid rounded" style="max-height: 500px;" alt="${title}">
                            </div>
                             <div class="p-2 bg-dark border-top border-secondary text-end">
                                <a href="${url}" download class="btn btn-sm btn-outline-light">
                                    <i class="fas fa-download"></i> Download
                                </a>
                            </div>
                        `;
                    }
                    html += `</div></div></div>`;
                }
            };

            // Heuristic to guess path based on arg presence
            // Client docs
            addItem('Government ID (Front)', front, `/photos/recruiter/${userId}/`);
            addItem('Government ID (Back)', back, `/photos/recruiter/${userId}/`);
            addItem('Legacy ID Document', doc, `/photos/recruiter/${userId}/`);
            addItem('Business License', license, `/photos/recruiter/${userId}/`);

            // Freelancer docs
            // Note: For freelancers, the 'doc' arg might be passed as their ID if we reuse this function carefully,
            // OR we can just check if 'resume' is present and use candidate path for it.
            // But wait, freelancers are different users. The 'doc' for them is in 'candidate'.
            // To simplify, let's assume the callers (buttons) will pass the correct path prefix or we handle it by context.
            // Actually, we can check if it's a freelancer based on resume being present or Front/Back being absent.
            // Let's rely on the caller to handle paths? No, templates are easier to write if function handles logic.
            // Let's split into viewRecruiterDocs and viewCandidateDocs for clarity, or pass type.

            // Since I cannot easily change all HTML buttons in one go without complex regex, 
            // I will implement 'openSingleDoc' for the images (easy) 
            // and 'viewAllDocs' for the button.

            if (resume && resume !== 'null') {
                addItem('Resume', resume, `/photos/candidate/${userId}/`);
            }
            // For freelancers, 'doc' is their ID.
            if (doc && resume) { // If resume exists, 'doc' is likely candidate ID
                // We already added 'doc' above with recruiter path. This is a BUG if we mix them.
                // Let's just fix the loop above.
            }

            contentDiv.innerHTML = html + '</div>';
            modal.show();
        }

        // Helper to view keys
        function viewRecruiterDocs(userId, front, back, doc, license) {
            const docs = [];
            if (front && front !== 'null') docs.push({ title: 'Government ID (Front)', url: `/photos/recruiter/${userId}/${front}` });
            if (back && back !== 'null') docs.push({ title: 'Government ID (Back)', url: `/photos/recruiter/${userId}/${back}` });
            if (doc && doc !== 'null') docs.push({ title: 'ID Document', url: `/photos/recruiter/${userId}/${doc}` });
            if (license && license !== 'null') docs.push({ title: 'Business License', url: `/photos/recruiter/${userId}/${license}` });
            viewDocumentCollection(docs);
        }

        function viewRecruiterDocsFromData(btn) {
            const data = btn.dataset;
            viewRecruiterDocs(data.userid, data.front, data.back, data.doc, data.license);
        }

        function viewJobSeekerDocs(userId, doc, resume) {
            const docs = [];
            if (doc && doc !== 'null') docs.push({ title: 'ID Document', url: `/photos/candidate/${userId}/${doc}` });
            if (resume && resume !== 'null') docs.push({ title: 'Resume', url: `/photos/candidate/${userId}/${resume}` });
            viewDocumentCollection(docs);
        }

        function viewJobSeekerDocsFromData(btn) {
            const data = btn.dataset;
            viewJobSeekerDocs(data.userid, data.doc, data.resume);
        }

        // Better implementation: pass arrays of {title, url}
        function viewDocumentCollection(documents) {
            const modal = new bootstrap.Modal(document.getElementById('documentModal'));
            const contentDiv = document.getElementById('documentContent');
            document.querySelector('.modal-title').textContent = 'Review Documents';
            contentDiv.innerHTML = '';

            if (documents.length === 0) {
                contentDiv.innerHTML = '<div class="text-center p-4 text-muted">No documents found.</div>';
                modal.show();
                return;
            }

            let html = '<div class="row g-4">';

            documents.forEach(doc => {
                if (!doc.url || doc.url.includes('null')) return;
                const isPdf = doc.url.toLowerCase().endsWith('.pdf');
                html += `
                    <div class="col-12">
                        <div class="card bg-secondary border-0">
                            <div class="card-header bg-transparent border-light">
                                <h6 class="mb-0 text-white">${doc.title}</h6>
                            </div>
                            <div class="card-body p-0 text-center">
                 `;

                if (isPdf) {
                    html += `<div class="ratio ratio-16x9"><iframe src="${doc.url}"></iframe></div>`;
                    html += `<div class="p-2 text-end"><a href="${doc.url}" target="_blank" class="btn btn-sm btn-primary">Open PDF</a></div>`;
                } else {
                    html += `<div class="p-3"><img src="${doc.url}" class="img-fluid rounded" style="max-height: 500px"></div>`;
                    html += `<div class="p-2 text-end"><a href="${doc.url}" download class="btn btn-sm btn-light">Download</a></div>`;
                }
                html += `</div></div></div>`;
            });

            contentDiv.innerHTML = html + '</div>';
            modal.show();
        }

        function openDocument(url, title) {
            viewDocumentCollection([{ title: title, url: url }]);
        }

        // Auto-refresh every 30 seconds
        setInterval(refreshData, 30000);

        // Initialize tooltips
        const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
        const tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl);
        });
    </script>
</body>

</html>